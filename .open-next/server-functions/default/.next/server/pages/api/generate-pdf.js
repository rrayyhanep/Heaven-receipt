"use strict";(()=>{var e={};e.id=271,e.ids=[271],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},364:(e,t,o)=>{o.r(t),o.d(t,{config:()=>u,default:()=>c,routeModule:()=>_});var i={};o.r(i),o.d(i,{default:()=>f});var n=o(1802),a=o(7153),r=o(6249);let l=require("pdfkit");var d=o.n(l),s=o(6048);let f=async(e,t)=>{if("POST"!==e.method)return t.setHeader("Allow",["POST"]),t.status(405).end(`Method ${e.method} Not Allowed`);let{employeeId:o,monthYear:i,advance:n=0,leaveDeduction:a=0}=e.body;if(!o||!i)return t.status(400).send("Missing required fields: employeeId and monthYear");try{let e=s.db.collection("employees").doc(o),r=await e.get();if(!r.exists)return t.status(404).send("Employee not found");let{name:l,basicSalary:f=0,pendingBalance:c=0}=r.data()||{},u=f-a,_=u-n,p=_+c;await e.update({pendingBalance:p});let v=new(d())({size:"A4",margin:50});t.setHeader("Content-Type","application/pdf"),t.setHeader("Content-Disposition",`attachment; filename=salary_slip_${l.replace(/ /g,"_")}_${i}.pdf`),v.pipe(t);let E=50;v.font("Helvetica-Bold").fontSize(20).text("SALARY SLIP",{align:"center"}),E+=35,v.strokeColor("#000000").lineWidth(1).moveTo(50,E).lineTo(545,E).stroke(),E+=20,v.font("Helvetica").fontSize(12),v.text("Company Name: Heaven Furniture",50,E),v.text(`Month & Year: ${i}`,{align:"right"}),E+=35,v.font("Helvetica-Bold").fontSize(14).text("Employee Details",50,E),E+=20,v.strokeColor("#000000").lineWidth(1).moveTo(50,E).lineTo(545,E).stroke(),E+=15,v.font("Helvetica").fontSize(12).text(`Employee Name: ${l}`,50,E),E+=35,v.font("Helvetica-Bold").fontSize(14).text("Earnings & Deductions",50,E),E+=20,v.strokeColor("#000000").lineWidth(1).moveTo(50,E).lineTo(545,E).stroke();let m=E+=10,A=50+2.66/3.66*495;v.rect(50,m,495,25).fill("#7a9cc6"),v.fillColor("#ffffff").font("Helvetica-Bold").fontSize(12),v.text("Particulars",60,m+7),v.text("Amount (Rs.)",A+10,m+7),E+=25;let S=[{label:"Basic Salary",value:f.toFixed(2)},{label:"Old Balance",value:c.toFixed(2)},{label:"Advance Taken",value:n.toFixed(2)},{label:"Leave Deduction",value:a.toFixed(2)},{label:"Total Salary (Basic - Leave)",value:u.toFixed(2)},{label:"Net Salary (Total - Advance)",value:_.toFixed(2)},{label:"Balance to Receive (Net + Old Balance)",value:p.toFixed(2)}];v.fillColor("#000000").font("Helvetica").fontSize(12),S.forEach(({label:e,value:t})=>{v.text(e,60,E+7),v.text(t,A+10,E+7,{align:"right",width:495-A-10}),E+=25});let h=E;v.strokeColor("#000000").lineWidth(.8),v.rect(50,m,495,h-m).stroke(),v.moveTo(A,m).lineTo(A,h).stroke();for(let e=0;e<=S.length;e++){let t=m+25*e;v.moveTo(50,t).lineTo(545,t).stroke()}E=h+50,v.font("Helvetica").fontSize(12),v.text("Employee Signature: _________________",50,E),v.text("Authorized Signature: _________________",{align:"right"}),v.end()}catch(e){console.error("PDF Generation Error:",e),t.status(500).send("Error generating PDF")}},c=(0,r.l)(i,"default"),u=(0,r.l)(i,"config"),_=new n.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/generate-pdf",pathname:"/api/generate-pdf",bundlePath:"",filename:""},userland:i})},6048:(e,t,o)=>{o.d(t,{db:()=>a});let i=require("firebase-admin");var n=o.n(i);if(!process.env.FIREBASE_SERVICE_ACCOUNT)throw Error("The FIREBASE_SERVICE_ACCOUNT environment variable is not set.");if(!n().apps.length)try{let e=JSON.parse(process.env.FIREBASE_SERVICE_ACCOUNT);n().initializeApp({credential:n().credential.cert(e)})}catch(e){throw console.error("Firebase initialization error:",e),Error("Failed to initialize Firebase. Please check the FIREBASE_SERVICE_ACCOUNT environment variable.")}let a=n().firestore()},7153:(e,t)=>{var o;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,t,o)=>{e.exports=o(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var o=t(t.s=364);module.exports=o})();